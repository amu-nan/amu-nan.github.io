<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organize - Xforia</title>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/organize.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <header>
        <div class="logo-container">
            <img src="../images/logo.png" alt="Xforia COAST Logo" class="logo">
            <span class="tagline">Your tagline goes here.</span>
        </div>
        <div class="coast-flow-header">
            <div class="coast-step-container">
                <span class="coast-letter active">C</span>
                <span class="coast-step-name active">Consolidate</span>
            </div>
            <div class="coast-step-container">
                <span class="coast-letter">O</span>
                <span class="coast-step-name">Organize</span>
            </div>
            <div class="coast-step-container">
                <span class="coast-letter">A</span>
                <span class="coast-step-name"></span>
            </div>
            <div class="coast-step-container">
                <span class="coast-letter">S</span>
                <span class="coast-step-name"></span>
            </div>
            <div class="coast-step-container">
                <span class="coast-letter">T</span>
                <span class="coast-step-name"></span>
            </div>
        </div>
    </header>

    <main class="organize-page">
        <section class="organize-container">
            <h2>Organize Data</h2>
            <div class="organize-form">
                <div class="input-group">
                    <label for="org-name">Company/Organization Name:</label>
                    <input type="text" id="org-name" placeholder="Enter company name">
                </div>
                <div class="input-group">
                    <label>Display all possible entities to choose from:</label>
                    <p>Select the entities you wish to see in the application.</p>
                    <div class="entity-bubbles">
                        <div class="bubble" data-entity="owner">Owner <span class="mandatory-star">&#9733;</span></div>
                        <div class="bubble" data-entity="nurse">Nurse <span class="mandatory-star">&#9733;</span></div>
                        <div class="bubble" data-entity="patient">Patient <span class="mandatory-star">&#9733;</span></div>
                        <div class="bubble" data-entity="relative">Relative</div>
                        <div class="bubble disabled" data-entity="supplier">Supplier</div>
                        <div class="bubble disabled" data-entity="admin">Admin</div>
                        <div class="bubble disabled" data-entity="lab">Lab</div>
                        <div class="bubble disabled" data-entity="doctor">Doctor</div>
                    </div>
                </div>
                <button id="continue-btn" class="continue-button">Continue</button>
            </div>
        </section>
    </main>

    <script src="../js/scripts.js"></script>
    <script>
        const continueBtn = document.getElementById('continue-btn');
        const orgNameInput = document.getElementById('org-name');
        const entityBubbles = document.querySelectorAll('.entity-bubbles .bubble:not(.disabled)');
        const disabledBubbles = document.querySelectorAll('.entity-bubbles .bubble.disabled');

        const selectedEntities = new Set();
        
        // Toggle selection
        entityBubbles.forEach(bubble => {
            bubble.addEventListener('click', () => {
                const entity = bubble.dataset.entity;
                if (bubble.classList.contains('selected')) {
                    selectedEntities.delete(entity);
                    bubble.classList.remove('selected');
                } else {
                    selectedEntities.add(entity);
                    bubble.classList.add('selected');
                }
            });
        });

        // Prevent clicking on disabled entities
        disabledBubbles.forEach(bubble => {
            bubble.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        });

        continueBtn.addEventListener('click', () => {
            const orgName = orgNameInput.value;
            const entitiesArray = Array.from(selectedEntities);

            sessionStorage.setItem('orgName', orgName);
            sessionStorage.setItem('selectedEntities', JSON.stringify(entitiesArray));

            window.location.href = 'rbac.html';
        });
    </script>
</body>
</html>
