<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - Xforia</title>
    <link rel="icon" type="image/png" href="../images/Subject.png">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/search.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <header>
        <div class="logo-container">
            <img src="../images/logo.png" alt="Xforia COAST Logo" class="logo">
            <span class="tagline">Your tagline goes here.</span>
        </div>
        <div class="coast-flow-header">
            <div class="coast-step-container">
                <span class="coast-letter">C</span>
                <span class="coast-step-name"></span>
            </div>
            <div class="coast-step-container">
                <span class="coast-letter">O</span>
                <span class="coast-step-name"></span>
            </div>
            <div class="coast-step-container">
                <span class="coast-letter">A</span>
                <span class="coast-step-name"></span>
            </div>
            <div class="coast-step-container">
                <span class="coast-letter active">S</span>
                <span class="coast-step-name active">Search</span>
            </div>
            <div class="coast-step-container">
                <span class="coast-letter">T</span>
                <span class="coast-step-name"></span>
            </div>
        </div>
    </header>

    <main class="search-page">
        <section class="search-content">
            <h2 class="page-title">Organization setup complete.</h2>
            <p class="select-text">Please choose which entity you want to continue as.</p>
            
            <div class="entities-selection-bubbles">
                </div>

            <button id="continue-btn" class="continue-button" disabled>Continue</button>
        </section>
    </main>

    <script src="../js/scripts.js"></script>
    <script>
        const entitiesContainer = document.querySelector('.entities-selection-bubbles');
        const continueBtn = document.getElementById('continue-btn');

        // Retrieve selected entities from sessionStorage (from the Organize page)
        const selectedEntities = JSON.parse(sessionStorage.getItem('selectedEntities')) || [];
        let selectedEntity = null;

        function renderEntities() {
            entitiesContainer.innerHTML = ''; // Clear previous bubbles
            selectedEntities.forEach(entity => {
                const bubble = document.createElement('div');
                bubble.className = 'bubble entity-bubble';
                bubble.textContent = entity.charAt(0).toUpperCase() + entity.slice(1);
                bubble.dataset.entity = entity;
                
                bubble.addEventListener('click', () => {
                    // Remove 'selected' class from all bubbles
                    document.querySelectorAll('.entity-bubble').forEach(b => b.classList.remove('selected'));
                    
                    // Add 'selected' class to the clicked bubble
                    bubble.classList.add('selected');
                    selectedEntity = entity;
                    continueBtn.disabled = false;
                });
                entitiesContainer.appendChild(bubble);
            });
        }
        
        // Render the bubbles when the page loads
        renderEntities();

        continueBtn.addEventListener('click', () => {
            if (selectedEntity) {
                // Save the single selected entity
                sessionStorage.setItem('selectedFinalEntity', selectedEntity);
                // Navigate to the next detailed search page
                window.location.href = 'detailed-search.html';
            }
        });

    </script>
</body>
</html>
